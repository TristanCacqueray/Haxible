( Playbook
    [ HostPlay
        { hosts = "localhost"
        , tasks =
            [ Task
                { name = Just "Create network"
                , action = "create_network"
                , attributes = Object
                    ( fromList
                        [
                            ( "name"
                            , String "private"
                            )
                        ]
                    )
                , requires = []
                , register = Just "network"
                , loop = Null
                , vars = []
                }
            , Task
                { name = Just "Create instances"
                , action = "create_instance"
                , attributes = Object
                    ( fromList
                        [
                            ( "name"
                            , String "{{ item }}"
                            )
                        ,
                            ( "network"
                            , String "{{ network.uid }}"
                            )
                        ]
                    )
                , requires = [ "network" ]
                , register = Nothing
                , loop = Array
                    [ String "backend"
                    , String "frontend"
                    , String "monitoring"
                    ]
                , vars = []
                }
            , Task
                { name = Just "Create storage"
                , action = "create_storage"
                , attributes = Object
                    ( fromList
                        [
                            ( "name"
                            , String "db"
                            )
                        ]
                    )
                , requires = []
                , register = Just "storage"
                , loop = Null
                , vars = []
                }
            , Task
                { name = Just "Create database"
                , action = "create_instance"
                , attributes = Object
                    ( fromList
                        [
                            ( "name"
                            , String "database"
                            )
                        ,
                            ( "network"
                            , String "{{ network.uid }}"
                            )
                        ,
                            ( "volume"
                            , String "{{ storage.uid }}"
                            )
                        ]
                    )
                , requires =
                    [ "network"
                    , "storage"
                    ]
                , register = Nothing
                , loop = Null
                , vars = []
                }
            , Task
                { name = Just "Create object"
                , action = "create_object"
                , attributes = Object
                    ( fromList
                        [
                            ( "name"
                            , String "standalone-object"
                            )
                        ]
                    )
                , requires = []
                , register = Nothing
                , loop = Null
                , vars = []
                }
            , Task
                { name = Just "Create network object"
                , action = "create_object"
                , attributes = Object
                    ( fromList
                        [
                            ( "name"
                            , String "network-{{ network.uid }}"
                            )
                        ]
                    )
                , requires = [ "network" ]
                , register = Nothing
                , loop = Null
                , vars = []
                }
            , Task
                { name = Nothing
                , action = "debug"
                , attributes = Object
                    ( fromList
                        [
                            ( "msg"
                            , String "Creating container service {{ image_name }}:{{ image_tag }}"
                            )
                        ]
                    )
                , requires = []
                , register = Nothing
                , loop = Null
                , vars =
                    [
                        ( "image_name"
                        , String "ubi8"
                        )
                    ,
                        ( "image_name"
                        , String "test"
                        )
                    ,
                        ( "image_tag"
                        , String "latest"
                        )
                    ]
                }
            ]
        , hostVars = []
        , playAttrs =
            [
                ( "hosts"
                , String "localhost"
                )
            ]
        }
    ]
, "{-# LANGUAGE QuasiQuotes, ApplicativeDo, OverloadedStrings #-}
  {- cabal:
  build-depends: base, haxible
  ghc-options: -threaded -rtsopts -with-rtsopts=-N -with-rtsopts=-T
  -}
  module Main (main) where

  import Haxible.Eval

  main :: IO ()
  main = runHaxible playbook

  playbook :: AnsibleHaxl [Value]
  playbook = do
    _play0 <- play_localhost
    pure $ _play0

  play_localhost :: AnsibleHaxl [Value]
  play_localhost = do
    let playAttr = [("hosts", [json| "localhost" |])]
    network <- runTask playAttr (Just "Create network") "create_network" [json| {"name":"private"} |] []
    _var1 <- traverse (\item ->  runTask playAttr (Just "Create instances") "create_instance" [json| {"name":"{{ item }}","network":"{{ network.uid }}"} |] [("item", item), ("network", network)] )  [[json| "backend" |], [json| "frontend" |], [json| "monitoring" |]]
    storage <- runTask playAttr (Just "Create storage") "create_storage" [json| {"name":"db"} |] []
    _var3 <- runTask playAttr (Just "Create database") "create_instance" [json| {"name":"database","network":"{{ network.uid }}","volume":"{{ storage.uid }}"} |] [("network", network), ("storage", storage)]
    _var4 <- runTask playAttr (Just "Create object") "create_object" [json| {"name":"standalone-object"} |] []
    _var5 <- runTask playAttr (Just "Create network object") "create_object" [json| {"name":"network-{{ network.uid }}"} |] [("network", network)]
    _var6 <- runTask playAttr (Nothing) "debug" [json| {"msg":"Creating container service {{ image_name }}:{{ image_tag }}"} |] [("image_name", [json| "ubi8" |]), ("image_name", [json| "test" |]), ("image_tag", [json| "latest" |])]
    pure [network, _var1, storage, _var3, _var4, _var5, _var6]

  "
)