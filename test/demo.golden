( Playbook
    [ HostPlay
        { hosts = "localhost"
        , tasks =
            [ Task
                { name = Just "Create network"
                , taskModule =
                    ( "create_network"
                    , Object
                        ( fromList
                            [
                                ( "name"
                                , String "private"
                                )
                            ]
                        )
                    )
                , requires = []
                , register = Just "network"
                , loop = Null
                , vars = []
                , taskAttrs =
                    [
                        ( "name"
                        , String "Create network"
                        )
                    ]
                }
            , Task
                { name = Just "Create instances"
                , taskModule =
                    ( "create_instance"
                    , Object
                        ( fromList
                            [
                                ( "name"
                                , String "{{ item }}"
                                )
                            ,
                                ( "network"
                                , String "{{ network.uid }}"
                                )
                            ]
                        )
                    )
                , requires = [ "network" ]
                , register = Nothing
                , loop = Array
                    [ String "backend"
                    , String "frontend"
                    , String "monitoring"
                    ]
                , vars = []
                , taskAttrs =
                    [
                        ( "name"
                        , String "Create instances"
                        )
                    ]
                }
            , Task
                { name = Just "Create storage"
                , taskModule =
                    ( "create_storage"
                    , Object
                        ( fromList
                            [
                                ( "name"
                                , String "db"
                                )
                            ]
                        )
                    )
                , requires = []
                , register = Just "storage"
                , loop = Null
                , vars = []
                , taskAttrs =
                    [
                        ( "name"
                        , String "Create storage"
                        )
                    ]
                }
            , Task
                { name = Just "Create database"
                , taskModule =
                    ( "create_instance"
                    , Object
                        ( fromList
                            [
                                ( "name"
                                , String "database"
                                )
                            ,
                                ( "network"
                                , String "{{ network.uid }}"
                                )
                            ,
                                ( "volume"
                                , String "{{ storage.uid }}"
                                )
                            ]
                        )
                    )
                , requires =
                    [ "network"
                    , "storage"
                    ]
                , register = Nothing
                , loop = Null
                , vars = []
                , taskAttrs =
                    [
                        ( "name"
                        , String "Create database"
                        )
                    ]
                }
            , Task
                { name = Just "Create object"
                , taskModule =
                    ( "create_object"
                    , Object
                        ( fromList
                            [
                                ( "name"
                                , String "standalone-object"
                                )
                            ]
                        )
                    )
                , requires = []
                , register = Nothing
                , loop = Null
                , vars = []
                , taskAttrs =
                    [
                        ( "name"
                        , String "Create object"
                        )
                    ]
                }
            , Task
                { name = Just "Create network object"
                , taskModule =
                    ( "create_object"
                    , Object
                        ( fromList
                            [
                                ( "name"
                                , String "network-{{ network.uid }}"
                                )
                            ]
                        )
                    )
                , requires = [ "network" ]
                , register = Nothing
                , loop = Null
                , vars = []
                , taskAttrs =
                    [
                        ( "name"
                        , String "Create network object"
                        )
                    ]
                }
            , Task
                { name = Nothing
                , taskModule =
                    ( "debug"
                    , Object
                        ( fromList
                            [
                                ( "msg"
                                , String "Creating container service {{ image_name }}:{{ image_tag }}"
                                )
                            ]
                        )
                    )
                , requires = []
                , register = Nothing
                , loop = Null
                , vars =
                    [
                        ( "image_name"
                        , String "ubi8"
                        )
                    ,
                        ( "image_name"
                        , String "test"
                        )
                    ,
                        ( "image_tag"
                        , String "latest"
                        )
                    ]
                , taskAttrs =
                    [
                        ( "vars"
                        , Object
                            ( fromList
                                [
                                    ( "image_name"
                                    , String "ubi8"
                                    )
                                ]
                            )
                        )
                    ]
                }
            ]
        , hostVars = []
        , playAttrs =
            [
                ( "hosts"
                , String "localhost"
                )
            ]
        }
    ]
, "{-# LANGUAGE QuasiQuotes, ApplicativeDo, OverloadedStrings #-}
  {- cabal:
  build-depends: base, haxible
  ghc-options: -threaded -rtsopts -with-rtsopts=-N -with-rtsopts=-T
  -}
  module Main (main) where

  import Haxible.Eval

  main :: IO ()
  main = runHaxible playbook

  playbook :: AnsibleHaxl [Value]
  playbook = do
    _play0 <- play_localhost
    pure $ _play0

  play_localhost :: AnsibleHaxl [Value]
  play_localhost = do
    let playAttr = [("hosts", [json| "localhost" |])]
    network <- runTask playAttr [json| {"create_network":{"name":"private"},"name":"Create network"} |] []
    _var1 <- traverse (\item ->  runTask playAttr [json| {"create_instance":{"name":"{{ item }}","network":"{{ network.uid }}"},"name":"Create instances"} |] [("item", item), ("network", network)] )  [[json| "backend" |], [json| "frontend" |], [json| "monitoring" |]]
    storage <- runTask playAttr [json| {"create_storage":{"name":"db"},"name":"Create storage"} |] []
    _var3 <- runTask playAttr [json| {"create_instance":{"name":"database","network":"{{ network.uid }}","volume":"{{ storage.uid }}"},"name":"Create database"} |] [("network", network), ("storage", storage)]
    _var4 <- runTask playAttr [json| {"create_object":{"name":"standalone-object"},"name":"Create object"} |] []
    _var5 <- runTask playAttr [json| {"create_object":{"name":"network-{{ network.uid }}"},"name":"Create network object"} |] [("network", network)]
    _var6 <- runTask playAttr [json| {"debug":{"msg":"Creating container service {{ image_name }}:{{ image_tag }}"},"vars":{"image_name":"ubi8"}} |] [("image_name", [json| "ubi8" |]), ("image_name", [json| "test" |]), ("image_tag", [json| "latest" |])]
    pure [network, _var1, storage, _var3, _var4, _var5, _var6]

  "
)